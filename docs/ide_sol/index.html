<!DOCTYPE html>
<html>
    <head>
        <title>Solidity IDE</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js" integrity="sha512-8RnEqURPUc5aqFEN04aQEiPlSAdE0jlFS/9iGgUyNtwFnSKCXhmB6ZTNl7LnDtDWKabJIASzXrzD0K+LYexU9g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <!-- <script
  type="text/javascript"
  src="https://binaries.soliditylang.org/bin/soljson-latest.js"
></script> -->

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/darcula.min.css" integrity="sha512-kqCOYFDdyQF4JM8RddA6rMBi9oaLdR0aEACdB95Xl1EgaBhaXMIe8T4uxmPitfq4qRmHqo+nBU2d1l+M4zUx1g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/addon/edit/matchbrackets.min.js" integrity="sha512-GSYCbN/le5gNmfAWVEjg1tKnOH7ilK6xCLgA7c48IReoIR2g2vldxTM6kZlN6o3VtWIe6fHu/qhwxIt11J8EBA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <script src="https://alincode.github.io/codemirror-solidity/solidity.js"></script>

        <link rel="stylesheet" href="https://alincode.github.io/codemirror-solidity/solidity.css" />

       



        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed&display=swap" rel="stylesheet">

    
    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1.3.2/dist/es-module-shims.js"></script>

    <script type="importmap">
      {
        "imports": {
          "solcjs": "https://binaries.soliditylang.org/bin/soljson-latest.js"
        }
      }
      </script>

<script src="https://unpkg.com/split.js/dist/split.min.js"></script>


<style>
html, body, .split, #out1, #out2 {
  width: 100%;
  height: 100%;
  border-color: transparent; 
  background-color: #2b2b2b;
  color: #a9b7c6;
  margin: 0px;
  font-family: "Roboto Condensed", sans-serif;
}

body, button, div, html, input, p, select, textarea {
  font-family: "Roboto Condensed", sans-serif;
}

input, select, textarea {
    border-radius: 5px;
    border: none;
    background: rgb(80 80 80/50%);
    outline: none;
    color: #a9b7c6;
}

a, button {
    cursor: pointer;
}
button {
    border-radius: 5px;
    background: #1a1a1a;
    padding-top: 3px;
    padding-bottom: 3px;
    border: 0px double #505050;
    color: #a9b7c6;
}


.CodeMirror {
  height: 100%;
}

textarea {
  -moz-appearance:none;
  outline:0px none transparent;
}

  .split {
    display: flex;
    flex-direction: row;
}

.gutter {
    background-color: #444;
    background-repeat: no-repeat;
    background-position: 50%;
}

.gutter.gutter-horizontal {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
    cursor: col-resize;
}

.gutter.gutter-vertical {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=');
    cursor: row-resize;
}

</style>
</head>
    <body>

        <div id="split-01"  class="split content">
          <div class="split">
            <div id="split-0">
              <textarea id="code">
// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.7.0 <0.9.0;

/**
  * @title Storage
  * @dev Store & retrieve value in a variable
  * @custom:dev-run-script ./scripts/deploy_with_ethers.ts
  */
contract Storage {

    uint256 number;

    /**
      * @dev Store value in variable
      * @param num value to store
      */
    function store(uint256 num) public {
        number = num;
    }

    /**
      * @dev Return value 
      * @return value of 'number'
      */
    function retrieve() public view returns (uint256){
        return number;
    }
}</textarea>
            </div>
            <div id="split-1">
              <textarea id="out1"></textarea>
            </div>
            <div id="split-2">
              <textarea id="out2"></textarea>
            </div>
          </div>
        </div>
        <div class="split content" id="split-02">
          <button id="compile" >&gt;</button>
          <div id="play"></div>
        </div>


    <script>
      Split(['#split-01', '#split-02'], {
    direction: 'vertical',
    sizes: [95,5],
    snapOffset: 10,
    cursor: 'row-resize',
})
      Split(["#split-0", "#split-1", "#split-2"],{
        snapOffset: 10,
      });

      const module = {};
      //console.log("ssolc", solc)
      
    </script>


<script>
  var worker = new Worker(
    './worker.js', 
    // { type: "module" }
  );
  console.log('---worker---', worker);
  worker.addEventListener('message', function (e) {
    console.log('worker sent message', e);
    const output = e.data.output
    for (var contractName in output.contracts['contract']) {
      console.log(`Bytecode of contract: ${contractName}: ${output.contracts['contract'][contractName].evm.bytecode.object}`);
    }
  }, false);

  worker.postMessage({
    contractCode: 'contract C { function f() public { } }',
  })
</script>

<!-- <script type="module">
  import * as wrapper from 'solc/wrapper';
  const solc = wrapper(window.Module);
  const compiler = solc.compile;

  // import * as solcjs from 'solcjs';
  //const solc = wrapper(window.Module);
  //import * as ssol from 'solc';
  //const solc = solcw();
  //const solc = wrapper(window.Module);

  //import * as wrapper from 'solc/wrapper';
//const solc = wrapper(window.Module);

  //console.log("ssol", solc)

  var input = {
  language: 'Solidity',
  sources: {
    'test.sol': {
      content: 'contract C { function f() public { } }'
    }
  },
  settings: {
    outputSelection: {
      '*': {
        '*': ['*']
      }
    }
  }
};


//const output = await solc.versions()
// const compiler = await solcjs("latest")


var output = JSON.parse(await compiler(JSON.stringify(input)));
console.log("outp", output)
  //import "wabt";
  //import {wabt} from 'https://cdn.jsdelivr.net/gh/AssemblyScript/wabt.js@1.0.29/index.js';
  //console.log(WabtModule)
  //var wabti = WabtModule();

  var wabt = null;
  //wabti.then((x)=>{wabt = x;})

  function doit(act){
    
    let els = document.querySelectorAll("."+act+"_")
    let outp = document.querySelector("."+act+"_o")
    let ins =[]
    for(let i = 0 ; i< els.length;i++ ){
      ins.push(els[i].value)
    }
    console.log(act,wout,els, ins)
    let ans = wout[act](...ins)
    outp.value = ans
    console.log(wout["memory"])
  }
  module.doit = doit
  

  function compileWasm(code1) {
    const module = wabt.parseWat('unnamed.wat', code1);
    module.resolveNames();
    module.validate();
    const binary = module.toBinary({log: true, write_debug_names:true});
    const {WebAssembly} = window;
    const wasm = new WebAssembly.Module(binary.buffer);
    const instance = new WebAssembly.Instance(wasm, {});
    console.log(binary,binary.buffer.length);
    return instance.exports;
  }

  var code = ""
  var wout ={}
  var btn = document.getElementById("compile")
  btn.addEventListener("click",()=>{
    let play = document.getElementById("play")
    wout = compileWasm(editor2.doc.getValue())
    console.log(wout);
    let hout="";
    for (let item in wout){
      if (item !="memory") {
        let inps = Array(wout[item].length).fill("<input onchange=\"module.doit('"+item+"')\" class=\""+item+"_\"></input>")
        hout = hout + " <button onclick=\"module.doit('"+item+"')\">"+ item+"</button>("+ inps.join(", ")+ (") = <input class=\""+item+"_o\"></input>")+"<br>";
      }
      
        
    }
    play.innerHTML = hout;
  })

  
  var value=""

      var stdout
      var error

      var editor1 = CodeMirror.fromTextArea(document.getElementById("out1"), {
                lineNumbers: true, 
                matchBrackets: true,
                lineWrapping: true,
                tabSize: 4,
                gutters: ["linenumbers", "foldgutter"],
                lineWrapping: true,
                indentWithTabs: true,
                theme: "darcula",
                mode: 'application/javascript',
				indentUnit: 4,
				indentWithTabs: true,
				// lint: true,
				gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
				foldGutter: true
        });


      var editor2 = CodeMirror.fromTextArea(document.getElementById("out2"), {
                lineNumbers: true, 
                matchBrackets: true,
                lineWrapping: true,
                tabSize: 4,
                gutters: ["linenumbers", "foldgutter"],
                lineWrapping: true,
                indentWithTabs: true,
                theme: "darcula",
                mode: 'application/javascript',
				indentUnit: 4,
				indentWithTabs: true,
				// lint: true,
				gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
				foldGutter: true
        });


      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
                lineNumbers: true, 
                matchBrackets: true,
                lineWrapping: true,
                tabSize: 4,
                gutters: ["linenumbers", "foldgutter"],
                lineWrapping: true,
                indentWithTabs: true,
                theme: "darcula",
                mode: "text/x-solidity",
				indentUnit: 4,
				indentWithTabs: true,
				// lint: true,
				gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter'],
				foldGutter: true
        });


        editor.on('change', (editor) => {
  const text = editor.doc.getValue();
  let out = document.getElementById("out1")
  //let addWASM = asc.compileString(addSource, { optimizeLevel: 3 })
  value = text;
  update()
  //out.innerHTML = text;
  console.log(text);
  
});
  
  
  async function update(){
    const files = {
      "index.ts": value
      //"export function add(a: i32, b: i32): i32 {\n            return a + b;\n          }"

    };
    
    // let out1 = await asc.main([
    //   "index.ts", "--textFile", "--optimize"
    // ], {
    //   readFile(name, baseDir) {
    //     if (Object.prototype.hasOwnProperty.call(files, name)) return files[name];
    //     return null;
    //   },
    //   writeFile(name, data, baseDir) {
    //   },
    //   listFiles(dirname, baseDir) {
    //     return [];
    //   }
    // });

    // error = out1.error
    // stdout = out1.stdout;

    //let addWASM = asc.compileString(addSource, { optimizeLevel: 3 })
    //out.innerHTML = stdout.toString();
    //code = stdout.toString();
    //editor2.doc.setValue(code)
    //compileWasm(code)
    //console.log(error, code);
  }
  update()
  // export { update }
  </script> -->
  


</body>
</html>