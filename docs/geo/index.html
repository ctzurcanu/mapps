<!DOCTYPE html>
<html>
  <head>
    <title>map, geolocation</title>
    <style>
      body,html {height:100%}
      #map {width:100%;height:100%;}
    </style>
    <script>
      function findGetParameter(parameterName) {
          var result = null,
              tmp = [];
          var items = location.search.substr(1).split("&");
          for (var index = 0; index < items.length; index++) {
              tmp = items[index].split("=");
              if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
          }
          return result;
      }

      function init(){
        var key = findGetParameter("key")
        var head= document.getElementsByTagName('head')[0];
      var script= document.createElement('script');
      script.src= "https://maps.googleapis.com/maps/api/js?key="+ key +"&libraries=places";
      head.appendChild(script);

    
      setTimeout(init1, 1000);

      
      }

      function init1(){
        var head= document.getElementsByTagName('head')[0];
        var script2= document.createElement('script');
      script2.src= "./simplegmaps.js";
      head.appendChild(script2);

      setTimeout(init2, 100);
      }

      function init2(){
        simplegmaps.init({
          container: '#simplegmaps-1',
          GeoLocation: true
        });
      }
    </script>
    

    <link href='./demo.css' rel='stylesheet' />
    
  </head>
  <body onload="init()">
    <div id="simplegmaps-1" class="google-map"></div>
  </body>
</html>