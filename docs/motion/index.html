<html lang=”en”>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Motion App</title>

    <script>
      var log = function(){
        let conso = document.getElementById("console")
        conso.innerHTML += JSON.stringify(arguments)+"<br>";
        console.log(...arguments);
      }
    </script>

</head>
<body>
<div id="console"></div>

  <script type="module">
    import {
      AbsoluteOrientationSensor,
      RelativeOrientationSensor
    } from './poly-motion-sensors.js';

    const params = new URLSearchParams(new URL(window.location.href).search.slice(1));
    const relative = !!Number(params.get("relative"));
const coordinateSystem = params.get("coord");

    let container, sensor, camera, scene, renderer, model;

    //initScene();
    if (navigator.permissions) {
        // https://w3c.github.io/orientation-sensor/#model
        Promise.all([navigator.permissions.query({ name: "accelerometer" }),
                     navigator.permissions.query({ name: "magnetometer" }),
                     navigator.permissions.query({ name: "gyroscope" })])
               .then(results => {
                    if (results.every(result => result.state === "granted")) {
                        initSensor();
                    } else {
                        log("Permission to use sensor was denied.");
                    }
               }).catch(err => {
                    log("Integration with Permissions API is not enabled, still try to start app.");
                    initSensor();
               });
    } else {
        log("No Permissions API, still try to start app.");
        initSensor();
    }

    function initSensor() {
                const options = { frequency: 1, coordinateSystem };
                log(JSON.stringify(options));
                sensor = relative ? new RelativeOrientationSensor(options) : new AbsoluteOrientationSensor(options);
                sensor.onreading = () => model.quaternion.fromArray(sensor.quaternion).inverse();
                sensor.onerror = (event) => {
                  if (event.error.name == 'NotReadableError') {
                    log("Sensor is not available.");
                  }
                }
                sensor.start();
            }

    </script>

    </body>
</html>